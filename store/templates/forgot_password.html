{% extends 'base.html' %}
{% load static %}
{% block content %}
	<!-- Start Banner Area -->
	<section class="banner-area organic-breadcrumb">
		<div class="container">
			<div class="breadcrumb-banner d-flex flex-wrap align-items-center justify-content-end">
				<div class="col-first">
					<h1>Forgot Password</h1>
					<nav class="d-flex align-items-center">
						<a href="{% url 'home' %}">Home<span class="lnr lnr-arrow-right"></span></a>
						<a href="{% url 'forgot_password' %}">Forgot Password</a>
					</nav>
				</div>
			</div>
		</div>
	</section>
	<!-- End Banner Area -->

	<!--================Login Box Area =================-->
	<section class="login_box_area section_gap">
		<div class="container">
			<div class="row">
				<div class="col-lg-6">
					<div class="login_box_img">
						<img class="img-fluid" src="{% static 'assets1/img/login.jpg' %}" alt="">
						<div class="hover">
							<h4>Remembered your password?</h4>
							<p>No problem, you can log in from here.</p>
							<a class="primary-btn" href="{% url 'login' %}">Log In</a>
						</div>
					</div>
				</div>
				<div class="col-lg-6">
					<div class="login_form_inner">
						<h3>Reset Your Password</h3>
                        <p>Enter your email address and we will send you a link to reset your password.</p>
						<form class="row login_form" method="post" id="resetPasswordForm" novalidate="novalidate">
							{% csrf_token %}
							<div class="col-md-12 form-group">
								<input type="email" class="form-control" id="email" name="email" placeholder="Email" onfocus="this.placeholder = ''" onblur="this.placeholder = 'Email'">
							</div>
							<div class="col-md-12 form-group">
								<button type="submit" value="submit" class="primary-btn">Send Reset Link</button>
							</div>
						</form>
						<div id="reset-message" style="margin-top: 15px;"></div>
					</div>
				</div>
			</div>
		</div>
	</section>
	<!--================End Login Box Area =================-->
	<script>
		document.getElementById('resetPasswordForm').addEventListener('submit', function(e) {
			e.preventDefault();
			const email = document.getElementById('email').value;
			const messageDiv = document.getElementById('reset-message');
			messageDiv.innerText = '';
            messageDiv.style.color = 'red'; // Default to error color

            // First, check if the email exists in our backend
            fetch("{% url 'forgot_password' %}", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ email: email }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    // If email exists in backend, proceed with Firebase reset
                    firebase.auth().sendPasswordResetEmail(email)
                        .then(() => {
                            messageDiv.style.color = 'green';
                            messageDiv.innerText = 'Password reset email sent! Please check your inbox.';
                        })
                        .catch((error) => {
                            messageDiv.innerText = 'Error sending email: ' + error.message;
                        });
                } else {
                    messageDiv.innerText = data.message;
                }
            })
            .catch((error) => {
                messageDiv.innerText = 'An error occurred. Please try again.';
            });
		});
	</script>
{% endblock %}